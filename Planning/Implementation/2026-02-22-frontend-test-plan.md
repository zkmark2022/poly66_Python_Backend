# Prediction Market — Frontend Integration Test Plan

> **执行者须知：**
> - 本测试计划由 Browser Use / Web Use AI 执行，模拟真实用户在浏览器中的操作。
> - 每步操作均注明**执行账号**、**UI 操作步骤**、**预期结果**。
> - 后端地址：`http://192.168.1.102:8000`
> - 前端地址：`http://[FRONTEND_URL]`（执行前替换为实际地址）
> - 如遇步骤失败，记录：实际看到的内容 + 截图路径，继续执行下一步。

---

## 测试账号

| 账号名 | 密码 | 邮箱 | 角色 |
|--------|------|------|------|
| `test_buyer` | `Test1234!` | `test_buyer@test.com` | 主买方 |
| `test_seller` | `Test1234!` | `test_seller@test.com` | 主卖方 |
| `test_observer` | `Test1234!` | `test_observer@test.com` | 观察者 |

> 所有账号在 T1 注册流程中创建。

---

## 可用市场

| 市场 ID | 标题 | 状态 |
|---------|------|------|
| `MKT-BTC-100K-2026` | Will BTC exceed $100,000 by end of 2026? | ACTIVE |
| `MKT-ETH-10K-2026` | Will ETH exceed $10,000 by end of 2026? | ACTIVE |
| `MKT-FED-RATE-CUT-2026Q2` | Will the Fed cut rates in Q2 2026? | ACTIVE |

---

## T1 — 注册与登录

### T1-1 注册 test_buyer
**执行账号：** 无（注册新账号）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 打开前端首页 | 看到登录/注册入口 |
| 2 | 点击「注册」按钮 | 进入注册页面 |
| 3 | 填写：用户名 `test_buyer`，邮箱 `test_buyer@test.com`，密码 `Test1234!` | 表单填写完成 |
| 4 | 点击「提交」 | 注册成功，跳转到登录页或自动登录 |

**成功标准：** 不显示错误，账号创建成功。

---

### T1-2 注册 test_seller
**执行账号：** 无（注册新账号）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入注册页面 | 看到注册表单 |
| 2 | 填写：用户名 `test_seller`，邮箱 `test_seller@test.com`，密码 `Test1234!` | 表单填写完成 |
| 3 | 点击「提交」 | 注册成功 |

**成功标准：** 账号创建成功，无错误。

---

### T1-3 注册 test_observer
**执行账号：** 无（注册新账号）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入注册页面 | 看到注册表单 |
| 2 | 填写：用户名 `test_observer`，邮箱 `test_observer@test.com`，密码 `Test1234!` | 表单填写完成 |
| 3 | 点击「提交」 | 注册成功 |

**成功标准：** 账号创建成功，无错误。

---

### T1-4 正常登录
**执行账号：** test_buyer

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入登录页面 | 看到登录表单 |
| 2 | 输入用户名 `test_buyer`，密码 `Test1234!` | 表单填写完成 |
| 3 | 点击「登录」 | 登录成功，进入主页或仪表板 |

**成功标准：** 页面显示已登录状态（如显示用户名或头像）。

---

### T1-5 错误密码登录
**执行账号：** test_buyer

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入登录页面 | 看到登录表单 |
| 2 | 输入用户名 `test_buyer`，密码 `WrongPassword` | 表单填写完成 |
| 3 | 点击「登录」 | 显示错误提示（如「用户名或密码错误」） |

**成功标准：** 不登录成功，显示错误信息。

---

## T2 — 账户资金

### T2-1 充值 test_buyer（充入 $500）
**执行账号：** test_buyer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入账户/钱包页面 | 看到当前余额（应为 $0） |
| 2 | 点击「充值」或「Deposit」 | 弹出充值表单 |
| 3 | 输入金额 `500`（美元或分，按界面单位） | 表单填写完成 |
| 4 | 点击「确认」 | 充值成功提示 |
| 5 | 查看余额 | 余额显示为 $500（或 50,000 分） |

**成功标准：** 余额从 $0 变为 $500。

---

### T2-2 充值 test_seller（充入 $500）
**执行账号：** test_seller（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入账户/钱包页面 | 看到当前余额（应为 $0） |
| 2 | 充值 $500，确认 | 充值成功 |
| 3 | 查看余额 | 余额显示为 $500 |

**成功标准：** 余额从 $0 变为 $500。

---

### T2-3 充值 test_observer（充入 $100）
**执行账号：** test_observer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 充值 $100，确认 | 充值成功 |
| 2 | 查看余额 | 余额显示为 $100 |

**成功标准：** 余额从 $0 变为 $100。

---

### T2-4 提现（小额）
**执行账号：** test_buyer（已登录，余额 $500）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入账户页面 | 看到余额 $500 |
| 2 | 点击「提现」或「Withdraw」 | 弹出提现表单 |
| 3 | 输入金额 `50` | 表单填写完成 |
| 4 | 点击「确认」 | 提现成功提示 |
| 5 | 查看余额 | 余额显示为 $450 |

**成功标准：** 余额减少 $50，变为 $450。

---

### T2-5 提现超出余额（异常测试）
**执行账号：** test_buyer（余额 $450）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 点击「提现」 | 弹出提现表单 |
| 2 | 输入金额 `9999`（远超余额） | 表单填写完成 |
| 3 | 点击「确认」 | 显示错误（余额不足） |

**成功标准：** 提现失败，显示错误信息，余额不变（仍为 $450）。

---

### T2-6 查看账本记录
**执行账号：** test_buyer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入账本/交易记录页面 | 显示历史记录列表 |
| 2 | 查看记录条目 | 应包含：充值 $500、提现 $50 的记录 |

**成功标准：** 账本显示至少 2 条记录，金额与操作一致。

---

## T3 — 市场浏览

### T3-1 查看市场列表
**执行账号：** test_observer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入市场列表页面 | 显示市场列表 |
| 2 | 确认看到以下市场：BTC、ETH、FED | 3 个市场均显示 |
| 3 | 每个市场应显示：标题、当前价格、状态 | 信息完整 |

**成功标准：** 看到 3 个 ACTIVE 市场。

---

### T3-2 查看市场详情
**执行账号：** test_observer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 点击 BTC 市场 | 进入市场详情页 |
| 2 | 查看市场信息 | 显示标题、描述、截止时间 |
| 3 | 查看订单簿（Order Book） | 显示买单列表和卖单列表 |

**成功标准：** 订单簿有数据（集成测试留下的挂单），显示买卖双方价格和数量。

---

### T3-3 验证订单簿格式
**执行账号：** test_observer（已登录，在 BTC 市场详情页）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 查看订单簿的买单（Bids）部分 | 按价格从高到低排列 |
| 2 | 查看订单簿的卖单（Asks）部分 | 按价格从低到高排列 |
| 3 | 确认价格在 1-99 范围内 | 所有价格合法 |

**成功标准：** 订单簿结构正确，价格排列符合预期。

---

## T4 — 下单与撤单

### T4-1 下 GTC YES 买单（挂单不成交）
**执行账号：** test_buyer（已登录，余额约 $450）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 ETH 市场 | 看到市场详情 |
| 2 | 点击「下单」或「Buy YES」 | 弹出下单表单 |
| 3 | 选择：方向=YES，操作=BUY，价格=`45`，数量=`10`，类型=GTC | 表单填写完成 |
| 4 | 点击「确认」 | 下单成功提示 |
| 5 | 查看我的订单列表 | 看到一笔 OPEN 状态的 YES BUY @45 订单 |
| 6 | 查看账户余额 | 余额减少（45×10 + 手续费预扣 = 约 $4.59 被冻结） |

**成功标准：** 订单状态为 OPEN，余额中有冻结金额。

---

### T4-2 下 GTC NO 买单（挂单不成交）
**执行账号：** test_seller（已登录，余额 $500）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 ETH 市场 | 看到市场详情 |
| 2 | 点击「买 NO」或「Buy NO」 | 弹出下单表单 |
| 3 | 选择：方向=NO，操作=BUY，价格=`45`（NO价格），数量=`10`，类型=GTC | 表单填写完成 |
| 4 | 点击「确认」 | 下单成功提示 |
| 5 | 查看我的订单列表 | 看到一笔 OPEN 状态的 NO BUY @45 订单 |

> 注：此时 YES @45 和 NO @45 不互补（45+45≠100），不会成交，两边都挂单。

**成功标准：** 订单状态为 OPEN。

---

### T4-3 撤单
**执行账号：** test_buyer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入我的订单列表 | 看到 T4-1 创建的 OPEN 订单 |
| 2 | 点击该订单的「撤单」按钮 | 弹出确认提示 |
| 3 | 确认撤单 | 撤单成功提示 |
| 4 | 查看订单列表 | 该订单状态变为 CANCELLED |
| 5 | 查看账户余额 | 冻结金额释放，可用余额恢复 |

**成功标准：** 订单变为 CANCELLED，冻结资金归还。

---

### T4-4 价格越界异常（异常测试）
**执行账号：** test_buyer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 BTC 市场，点击下单 | 弹出下单表单 |
| 2 | 输入价格 `0` | 表单填写完成 |
| 3 | 点击「确认」 | 显示错误（价格必须在 1-99 之间） |
| 4 | 修改价格为 `100` | 表单填写完成 |
| 5 | 点击「确认」 | 显示错误（价格必须在 1-99 之间） |

**成功标准：** 两次都显示错误，订单未创建。

---

### T4-5 余额不足下单（异常测试）
**执行账号：** test_observer（已登录，余额 $100）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 BTC 市场，点击下单 | 弹出下单表单 |
| 2 | 输入：YES BUY，价格=`80`，数量=`500`（需要 $400，超出余额） | 表单填写完成 |
| 3 | 点击「确认」 | 显示错误（余额不足） |

**成功标准：** 下单失败，显示余额不足错误。

---

## T5 — 撮合成交场景

> **说明：** YES 价格 + NO 价格 = 100 时触发 MINT（新建仓位）。
> 例：test_buyer 买 YES @65，test_seller 买 NO @35，互补成交。

### T5-1 MINT 场景（双方开仓）

**第一步：test_seller 先挂 NO 买单**

**执行账号：** test_seller（已登录，余额 $500）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 BTC 市场，点击「买 NO」 | 弹出下单表单 |
| 2 | 输入：NO BUY，价格=`35`，数量=`20`，类型=GTC | 表单填写完成 |
| 3 | 点击「确认」 | 下单成功，订单状态 OPEN |

---

**第二步：test_buyer 下 YES 买单，触发撮合**

**执行账号：** test_buyer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 BTC 市场，点击「买 YES」 | 弹出下单表单 |
| 2 | 输入：YES BUY，价格=`65`，数量=`20`，类型=GTC | 表单填写完成 |
| 3 | 点击「确认」 | 下单成功 |
| 4 | 查看订单状态 | 订单应为 FILLED（成交 20 股） |
| 5 | 查看 test_buyer 的持仓 | 应显示 YES 持仓 20 股 |
| 6 | 查看 test_buyer 余额 | 已扣除 65×20 = $1300（注意单位，以界面显示为准）加手续费 |

---

**第三步：验证 test_seller 的持仓**

**执行账号：** test_seller（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 查看订单列表 | NO BUY 订单应为 FILLED |
| 2 | 查看持仓 | 应显示 NO 持仓 20 股 |
| 3 | 查看成交记录 | 应有一笔成交，价格 65（YES 侧），数量 20 |

**成功标准：** 双方都有持仓，订单都是 FILLED。

---

### T5-2 TRANSFER_YES 场景（持仓转手）

> test_buyer 持有 YES 仓位，现在卖出给 test_observer（新 YES 买家）

**第一步：test_observer 挂 YES 买单**

**执行账号：** test_observer（已登录，余额 $100）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 BTC 市场，点击「买 YES」 | 弹出下单表单 |
| 2 | 输入：YES BUY，价格=`65`，数量=`5`，类型=GTC | 表单填写完成 |
| 3 | 点击「确认」 | 下单成功，订单 OPEN |

---

**第二步：test_buyer 卖出 YES，触发 TRANSFER_YES**

**执行账号：** test_buyer（已登录，持有 YES 仓位 20 股）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 BTC 市场，点击「卖 YES」或「Sell YES」 | 弹出下单表单 |
| 2 | 输入：YES SELL，价格=`65`，数量=`5`，类型=GTC | 表单填写完成 |
| 3 | 点击「确认」 | 下单成功 |
| 4 | 查看订单状态 | 应为 FILLED |
| 5 | 查看 test_buyer 持仓 | YES 持仓从 20 减少到 15 |
| 6 | 查看 test_observer 持仓 | YES 持仓增加 5 股 |

**成功标准：** YES 仓位从 test_buyer 转移到 test_observer。

---

### T5-3 BURN 场景（双方平仓）

> test_buyer 卖 YES，test_seller 卖 NO，互补成交，仓位销毁

**第一步：test_seller 挂 NO 卖单**

**执行账号：** test_seller（已登录，持有 NO 仓位 20 股）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 BTC 市场，点击「卖 NO」 | 弹出下单表单 |
| 2 | 输入：NO SELL，价格=`35`（NO 价格），数量=`10`，类型=GTC | 表单填写完成 |
| 3 | 点击「确认」 | 下单成功，订单 OPEN |

---

**第二步：test_buyer 卖 YES，触发 BURN**

**执行账号：** test_buyer（已登录，持有 YES 仓位 15 股）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 BTC 市场，点击「卖 YES」 | 弹出下单表单 |
| 2 | 输入：YES SELL，价格=`65`，数量=`10`，类型=GTC | 表单填写完成 |
| 3 | 点击「确认」 | 下单成功 |
| 4 | 查看订单状态 | 应为 FILLED |
| 5 | 查看 test_buyer 持仓 | YES 持仓从 15 减少到 5 |
| 6 | 查看 test_seller 持仓 | NO 持仓从 20 减少到 10 |
| 7 | 查看双方余额 | 两人都收到了出售仓位的资金 |

**成功标准：** 双方持仓减少，余额增加。

---

## T6 — 持仓与成交历史

### T6-1 查看持仓列表
**执行账号：** test_buyer（已登录，经过 T5 后有 YES 持仓）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入「持仓」或「Positions」页面 | 显示持仓列表 |
| 2 | 查看 BTC 市场的 YES 持仓 | 应显示数量和成本 |
| 3 | 确认无其他市场持仓（如果没下其他单） | 仅 BTC 市场有持仓 |

**成功标准：** 持仓数据与 T5 操作后的预期一致。

---

### T6-2 查看成交历史
**执行账号：** test_buyer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入「成交记录」或「Trades」页面 | 显示成交列表 |
| 2 | 查看记录条数 | 应有至少 3 笔（T5-1 买入、T5-2 卖出、T5-3 卖出） |
| 3 | 查看每笔记录内容 | 应包含：市场、价格、数量、时间 |

**成功标准：** 成交记录数量和内容与操作历史一致。

---

### T6-3 查看单个市场持仓详情
**执行账号：** test_seller（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入持仓列表 | 看到 BTC 市场 NO 持仓 |
| 2 | 点击该持仓进入详情 | 显示该市场的 NO 持仓详细信息 |

**成功标准：** 详情页显示 NO 持仓数量（应为 10 股，经过 T5-3 平仓后）。

---

## T7 — 异常与边界情况

### T7-1 撤销已成交订单（异常测试）
**执行账号：** test_buyer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入订单列表 | 看到已成交（FILLED）的订单 |
| 2 | 尝试点击该订单的「撤单」按钮 | 按钮应该不可点击，或点击后显示错误 |

**成功标准：** 无法撤销已成交的订单。

---

### T7-2 订单数量超限（异常测试）
**执行账号：** test_buyer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 进入 FED 市场，点击下单 | 弹出下单表单 |
| 2 | 输入：YES BUY，价格=`50`，数量=`99999`（超过最大限制 10,000） | 表单填写完成 |
| 3 | 点击「确认」 | 显示错误（数量超出限制） |

**成功标准：** 下单失败，显示数量超限错误。

---

### T7-3 查看订单簿实时更新
**执行账号：** test_observer（已登录）

| # | 操作 | 预期结果 |
|---|------|---------|
| 1 | 打开 BTC 市场详情，记录当前订单簿状态 | 记录买卖盘价格和数量 |
| 2 | 切换到 test_buyer 账号（新窗口/标签） | 保持两个窗口 |
| 3 | test_buyer 在 BTC 市场下一笔 YES BUY @70，qty=5，GTC | 下单成功 |
| 4 | 切回 test_observer 窗口，刷新市场页面 | 订单簿中应出现 YES BUY @70 的挂单 |

**成功标准：** 订单簿在下单后正确反映新挂单。

---

## 测试完成后的验证

执行完所有测试后，请记录以下信息并反馈给后端（供日志对比）：

1. **每个账号的最终余额**（可用余额 + 冻结余额）
2. **每个账号的持仓情况**（市场、YES/NO、数量）
3. **遇到错误的测试步骤列表**（步骤编号 + 实际看到的内容）
4. **与预期结果不符的步骤**（即使没有报错）

---

## 附录：价格机制说明

| 概念 | 说明 |
|------|------|
| YES 价格 | 表示你认为事件发生的概率，范围 1-99（单位：分） |
| NO 价格 | 100 - YES 价格 |
| 撮合条件 | 买 YES @P1 + 买 NO @(100-P1) → 两笔互补成交（MINT） |
| 最小下单量 | 1 股 |
| 最大下单量 | 10,000 股 |
| 手续费 | 0.2%（20 bps），从成交方（Taker）收取 |
